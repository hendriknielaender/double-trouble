---
publishDate: "August 3 2023"
title: "Go 1.21: Now with More Gopher Power and Less 'Go-tchas'!"
description: "Explore innovative features, including enhanced map and slice operations, structured logging..."
image: ~/assets/images/thumbnails/gopher.png
imageCreditUrl: https://labs.openai.com/
tags: [gptpost, update, release, go, golang, code]
---

# The Exciting New Features of Go 1.21: A Deep Dive

As August 2023 rolls around, it's time to turn our attention to the release of Go 1.21, which promises to make Gophers' lives even more comfortable. This release is chock-full of enhancements and new features focusing on improving the developer experience, performance, and quality of life.

Let's dive right in and see what's new in this exciting release!

## Clear Built-in Function

Prior to Go 1.21, to clear a map or a slice, we had to manually iterate over the elements and remove or zero them out. Now, the new clear built-in function takes care of this for us:

```go

m := map[string]string{"foo": "bar"}

clear(m) // m={}

s := []string{"foo", "bar"}

clear(s) // s=["", ""]

```

This significantly simplifies the code and even handles edge cases, like NaN, that previous versions couldn't.

## Loop Variable Experiment

A new opt-in experiment that changes the semantics of loop variables to prevent unintended sharing in per-iteration closures and goroutines. With the GOEXPERIMENT=loopvar flag, the compiler ensures that each iteration creates a new variable, thus eliminating a common bug in many codebases.

```shell

$ GOEXPERIMENT=loopvar go1.21rc3 run main.go

```

## Structured Logging with `slog`

The new log/slog package, introduced in Go 1.21, provides structured logging with levels, emitting key=value pairs for machine processing. It's flexible, customizable, and even allows you to rewrite log keys and values on the fly. Here is an example of its usage:

```go

logger := slog.New(slog.NewTextHandler(os.Stderr, nil))

// Use it like this:

logger.Info("hello", "counter", 3)

```

It's expected that this package will become the standard way to handle logging in Go, increasing library portability.

## Maps and Slices Packages

Go 1.21 introduces two new packages to the standard library: `maps` and `slices`. These packages provide functions for very common map and slice operations. Here are a few examples of how to use these new functions:

```go

test := []string{"A", "C", "B", "A"}

// Use the new slice functions

slices.IsSorted(test) // false
slices.Sort(test) // [A A B C]
slices.Compare(test, []string{"A", "A", "B", "C"}) // 0
slices.BinarySearch(test, "B") // 1 true
slices.Reverse(test)// [C B A A]
slices.Insert(test, 1, "D") // [A D A B C]
slices.Compact(test)// [A D B C]
```

## OnceValue and OnceFunc

The new `sync.OnceValue` and `sync.OnceFunc` functions allow you to lazily initialize a value on the first use. These functions can be very useful for expensive operations that should only be computed once. Here's an example:

```go
var onlyOnce int = sync.OnceValue[int](func() int {
    // code here
})
```

## Built-in Min and Max Functions

New built-in min and max functions that allow you to find the minimum and maximum values from a list of arguments, respectively. They support integers, floats, and strings.

```go
m := min(x, y)    // m is the smaller of x and y

c := max(1, 2.0)  // c == 2.0

t := max("", "foo", "bar") // t == "foo"
```

## Profile Guided Optimization (PGO)

Go 1.21 enables AutoFDO by default, a feature that was introduced in Go 1.20. AutoFDO uses profile data collected from the execution of instrumented binaries to guide the optimization of the code, leading to performance improvements.

---

Go 1.21 brings a host of exciting new features and changes, making the language more powerful and easier to use. Whether it's the convenience of new built-in functions, the enhanced logging capabilities, or the improvements brought by PGO, this new release reaffirms Go's commitment to providing a fast, efficient, and developer-friendly environment.
