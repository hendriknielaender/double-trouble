---
publishDate: "Oct 14, 2023"
title: "The best IaC tool in 2023"
description: "A fresh look at infrastructure provisioning tools in 2023 and their performance across different categories."
image: "~/assets/images/thumbnails/iac_best_2023.jpg"
imageCreditUrl: https://labs.openai.com/
tags: [terraform, cloud, infrastructure, IaC, ranking, aws, serverless, bun, cdk]
---
import GithubRepoTag from "~/components/atoms/GithubRepoTag.astro";
import InfoText from "~/components/atoms/InfoText.astro";

The recent release of bun 1.0 still has us all hyped up. The unseen speed of bun, together with a
completely overhauled dev experience by unifying the wide range of tools into one is simply
amazing. This new sense of speed and convenience got us thinking also about other tools - what
about IaC?

At the workplace, the choice of IaC tooling is largely determined by company policy, by what is
generally already used and works reasonably well. Through years of evolution and growing maturity,
a hand ful of projects have gained the most popularity: CDK and terraform (data?). But taking a fresh
look today, what could be the best tool today in the context of serverless AWS?

Let's find out and take a look at the best infrastructure tools of the year. We'll evaluate
currently available infrastructure as code (IaC) tools, and look at them within certain
categories. This is in a specific context which we believe is relevant today: A lambda function
within an AWS account, which runs ontop of bun.

*All the code related to this comparison can be found in this repository:* <GithubRepoTag text="lambda-iac-2023" repoSlug="flyck/lambda-iac-2023" stargazers="0" issues="0"/>.

## Contenders

### Terraform

<GithubRepoTag text="Terraform" repoSlug="hashicorp/terraform" stargazers="39.1k" issues="1.7k"/> is
an IaC tool that allows you to create both cloud and on-premise infrasture, with providers
available for all major clouds. The code is comprised of the hashicorp language, a custom language
for templating. It supports basic programming features like loops, modules and variables within
certain limits(?).

### Open Tofu

Terraform has recently announced a scary license change, which might restrict the availiability of
terraform in the future. For this reason, the open terraform dubbed as <GithubRepoTag
text="opentofu" repoSlug="opentofu/opentofu" stargazers="15.3k" issues="119"/> repository has been
started in protest. If the license change goes through, this will be a more future-proof version
of terraform, while it has the same core features. Providers won't be affected.

### CDK

The <GithubRepoTag repoSlug="aws/aws-cdk" text="CDK" stargazers="10.7k" issues="1.9k"/> is the
programmatic solution from AWS for IaC tooling. The AWS CTO himself Werner Vogels praised the CDK
as the revolutionary [^1] [^2], and it was the first popular tool to offer infrastructure code
definition via a regular programming language. The initial hype for the CDK has led to a wide
adaption, while it also exposed its limits and shortcomings.

### CDKTF

While the CDK uses AWS CloudFormation under the hood, <GithubRepoTag text="CDKTF"
repoSlug="hashicorp/terraform-cdk" stargazers="4.6k" issues="296"/> uses terraform. This allows to
break the boundaries which exist in certain cases in the hashicorp configuration syntax, and use
"real code". It attempts to combine the benefits of terraform with the flexibility offered by the CDK.

### SST

The serverless stack <GithubRepoTag text="sst" repoSlug="sst/sst" stargazers="18.1k"
issues="660"/> is a combination of tools which aims at providing the best modern developer
experience for fullstack application building. Historically it was comprised of a collection of
streamlined CDK constructs and a live lambda development console. Recently the new and improved
SST Console has been added, which aims at improving the overview over the provisioned
resources. It is like the CDK but with massive batteries included.

### Serverless Framework

An oppiniated tool aimed at simplicity and developer experience around serverless services is the
<GithubRepoTag text="serverless framework" repoSlug="serverless/serverless" stargazers="45.3k"
issues="1k"/>. While it is also connected to a web console for CI/CD, monitoring and debugging,
the main part - the cli makes it easy to deploy lambdas, api gateways and more. Infrastructure is
defined in one yaml file, which can be extended with various plugins.

### AWS SAM

Possibly the initial Amazonian answer to the Serverless Framework is <GithubRepoTag text="AWS SAM"
repoSlug="aws/aws-sam-cli" stargazers="6.4k" issues="383"/>. It's maskot is a little beaver, which
is supposed to help get your things running in the cloud. While it is not as sophisiticated as the
CDK, it has many features which are more geared towards developer productivity, which is also why
the CDK has dependencies on SAM for things like local execution.

<br />
*Non-Contenders*: Among the wide assortment of tools which can be used to provision infrastructure,
there are some we didn't consider for various reasons. For the interested reader, we're still
listing them here for completeness: Pulumi, AWS Cloudformation, AWS Copilot, AWS Composer, AWS App
Runner, AWS Proton, AWS Lightsail, AWS EBS & AWS Amplify.



## Evaluation
|Category|Terraform|Open Tofu|CDK|CDKTF|SAM|SST|Serverless Framework|
|-|-|-|-|-|-|-|-|
|Github Stars|39.1k|15.3k|10.7k|4.6k|6.4k|18.1k|45.3k|
|Github Issues|1.7k|119|1.9k|296|383|660|1k|
|Bootstrap Time|18s|18s|?|?|47s|?|?|
|First deployment time|25s|35s (why?)|?|?|49s|?|?|
|Code deployment time|15s|15s|?|?|31s|?|?|
|Dirty deployment time|15s|15s|?|?|10s|?|?|
|Local Execution|0|0|0.5 <InfoText text="Works by leveraging AWS SAM. Same limitation as sam, plus it doesn't support hot reloading (aws-sam-cli/issues/4000)" />|0|0.5 <InfoText text="Does work in general but not for the bun lambda layer. Bun runtime wont start because sam local won't pass a traceId." />|?|?|
|Local Debugging|0|0|?|0|?|?|?|
|Streamed Cloud Execution|0|0|0|0|0|1|0|
|Overall DX        |2 <InfoText text="It is simple and does what it's supposed to do. No local execution but also no surprises. Faster than all the other tools." />|2|1-2 <InfoText text="The amount of work-arounds and hacks needed to make the CDK work right is crazy. Local execution only by hooking in SAM." />|1 <InfoText text="Not a drop-in replacement to the normal CDK dependency at all as one might expect. Completely new packages that need to be seperately downloaded which are also not typed." />|1-2|?|3|
|Versatility Rating|3|3|2-3|1|2|?|1|
|Score|||||3.1|||

Bootstrap time: Some IaC frameworks use some kind of resources for state or access management,
which is shared across IaC projects within the same account.

Versatility Rating: The ability to add other infrastructure ontop of the lambda function and extend the
given stack

#### Evaluation Takeaways

What we immediately learned from the evaluation:


- AWS has some variety in the time the api calls take, which we especially observed for
the lambda updateFunction call. It can be as fast as 15s but a moment later it might be at
35s. This makes a true obsession and optimization for speed a little bit difficult, and leaves the
numbers in that code category more as a median than an exact value.
- Debugger integration depends on the tool working together with the build utility. As bun is
still in the early stages, bun is not yet supported by most of the tools.

#### Cloudformation and the Limits of Abstraction

Most of the IaC tools we can chose from use Cloudformation under the hood. It's emphasis
historically has been moving infrastructure from one sane state to the next. Changing
infrastructure was a bit scary, and Cloudformation was a great tool in that scenario. In todays
world, for whatever reason, it seems the parameters have changed. Updates today seem to be far
more frequent, and dependencies between resources exist more in lambda code, rather than
infrastructure definitions. While this might not be the whole reason, the observation is that the
whole Cloudformation state handling in serverless seems like a feature that is a little bit of a
surplus. Flags like the cdks `--hotswap` and `--no-rollback`show, that a perfect stack state is no
longer the most relevant. Still, if anything in those IaC tools breaks, you will have to dive deep
into the Cloudformation level.

This begs the question if future AWS IaC tools will always depend on Cloudformation, requiring you
as the user to dive into intricacies of that, or if a new methodology will arise. This additional
layer of tooling under the hood is at least something that is already a minor inconvenience,
dealing with serverless infrastructure today. Many infrastructure tools today still expect you to
dive into Cloudformation when needed, while wholistic tools that try to hide all abstractions have
failed (Amplify, Beanstalk). It will be interesting to seee if this sea of complexity can ever be
bridged.

#### AWS and speed

Lay out the limits of spped of IaC tools to be anywhere near as fast as bun while dealing with
AWS. Removing a role: 30s. Updating lambda function code: 15s (high variation). Creating a VPC
adapter for a lambda: multiple minutes. Updating a cloudfront distribution: up to 20 minutes.

#### Local Debugging outside of IaC Tools

Give a generic way to start the debugger (with bun) despite of the IaC tool.

A generic node / bun approach outside of the IaC tool might come to the rescue here:
[link](https://stackoverflow.com/questions/64689865/debugging-lambda-locally-using-cdk-not-sam).

## On the sidelines: Winglang

<GithubRepoTag text="Winglang" repoSlug="winglang/wing" stargazers="2.6k" issues="671"/> is an
up-and-coming IaC tool, but it is also more than that. It got founded in late 2022[^5] by the
original creator of the code that eventually became the CDK, Elad Ben-Israel
[@emeshbi](https://twitter.com/emeshbi). At its core it is a new programming language, which uses
one piece of code to instruct both the infrastructure and the business logic together (called as
"preflight" vs "inflight" code). It hereby diffuses the division between infrastructure and
application code, bringing them all into the same place.

The wing project itself is a combination of this new wing programming language, a local cloud
simulater & dashboard, together with exports into different IaC tools (terraform or cdk), so they
can provision the needed infrastructure after compilation. At the moment they are [not yet
production ready](https://www.winglang.io/contributing/status), and only a few resources are
supported. Yet, the most important serverless resources are already there: a lambda function, SQS
queues, a bucket and a dynamoDB table (as the primitive form of a "counter").

Let's see an example of this. The following snipped is just the example snippet from their
website, and it creates a bucket, a lambda, an sqs queue and a dynamodb for the counter:

```typescript
bring cloud;

let queue = new cloud.Queue(timeout: 2m);
let bucket = new cloud.Bucket();
let counter = new cloud.Counter(initial: 100);

queue.setConsumer(inflight (body: str): str => {
  let next = counter.inc();
  let key = "myfile-${next}.txt";
  bucket.put(key, body);
});
```

In our estimate Winglang is a huge leap forward from the current paradigms of IaC. If it can
deliver on its promises, it might not be the solution that the whole engineering uses for every
project, but it might be that awesome tool to get small things done with ease and pleasure. Given
that Wing works with JSII just like the CDK, it can also import JSII compatible code like the CDK
back into its code. Seems Elad really fell in love with this concpet here. With this wing might be
even somewhat similar to SST, by giving better abstractions ontop of the CDK, just on a whole
different level.

Wing seems to aim to bring the developer experience to such a level of abstraction and simplicity,
that even a project manager could solve simple problems. This is something that none of the other
infrastructure related tools have so far attempted.

## Rounding up

Going into writing this post, we had a suspicion that terraform was simply going to be fastest, as
it doesn't rely on CloudFormation under the hood. After years of being the reigning champion, the
reputation of the CDK for us and others[^3] [^4] has weakened. CDKs weird packaging, together with
the v2/v3 migration efforts, the various work-arounds and helpers needed to work with the CDK, the
disappointment of "awesome reusable contructs" remaining mostly a theory. Going into it we thought
to find out that something like terraform was going to be the best after all.

Looking at the range of tools that is available, it has become again obvious that some of them are
more geared towards serverless development than others. At the same time within your own
organization you may have teams which have a different areas of focus. Having these
serverless-tuned tools for us made for a far better development experience, less frustrations and
faster iterations. Depending on your flexibility, in the end it might not be a question of "the
best tool", but choosing different tools depending on the purpose.

For our purpose of serverless bun lambda functions, the ?.


### Footnotes
[^1]: https://twitter.com/Werner/status/1528384285924806657
[^2]: https://www.youtube.com/watch?v=AYYTrDaEwLs
[^3]: https://www.alexdebrie.com/posts/serverless-framework-vs-cdk/
[^4]: https://theburningmonk.com/2023/04/are-you-ready-for-this-top-5-earth-shattering-pros-and-cons-of-aws-cdk/
[^5]: https://twitter.com/winglangio account got created in Aug 2022
