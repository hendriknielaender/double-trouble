---
import { SITE, BLOG } from "~/config.mjs";

import Layout from "~/layouts/PageLayout.astro";
import SinglePost from "~/components/blog/SinglePost.astro";

import {
  getCanonical,
  getPermalink,
  cleanSlug,
  POST_BASE,
} from "~/utils/permalinks";
import { fetchPosts, getStaticPathsBlogPost } from "~/utils/blog";
import { findImage } from "~/utils/images";
import type { Post } from "~/types";
import type { GetStaticPaths } from "astro";

interface Props {
  post: Post
}
export const getStaticPaths = (async () => {
  return await getStaticPathsBlogPost();
}) satisfies GetStaticPaths;
const { post } = Astro.props;
const url = getCanonical(getPermalink(post.slug, "post"));

const meta = {
  title: `${post.title} â€” ${SITE.name}`,
  description: post.description,
  canonical: post.canonical || url,
  image: await findImage(post.image),
  ogTitle: post.title,
  ogType: "article",
};
---

<Layout {meta}>
  <SinglePost post={{ ...post, image: meta.image }} url={url} >
    {post.Content ? <post.Content /> : <Fragment set:html={post.content || ''} />}
  </SinglePost>
</Layout>
